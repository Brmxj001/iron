<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Responsive Admin Dashboard Template">
        <meta name="keywords" content="admin,dashboard">
        <meta name="author" content="stacks">
        <!-- The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!-- Title -->
        <title>Connect - Responsive Admin Dashboard Template</title>

        <!-- Styles -->
        <link
                href="https://fonts.googleapis.com/css?family=Lato:400,700,900&display=swap"
                rel="stylesheet">
        <link
                href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700&display=swap"
                rel="stylesheet">
        <link
                href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
                rel="stylesheet">
        <link th:href="@{/plugins/bootstrap/css/bootstrap.min.css}"
              href="../../assets/plugins/bootstrap/css/bootstrap.min.css"
              rel="stylesheet">
        <link th:href="@{/plugins/font-awesome/css/all.min.css}"
              href="../../assets/plugins/font-awesome/css/all.min.css"
              rel="stylesheet">
        <link th:href="@{/iron/css/iron.css}" rel="stylesheet">
        <!-- Theme Styles -->
        <link th:href="@{/css/connect.min.css}"
              href="../../assets/css/connect.min.css" rel="stylesheet">
        <link th:href="@{/css/admin4.css}" href="../../assets/css/admin4.css"
              rel="stylesheet">
        <link th:href="@{/css/dark_theme.css}"
              href="../../assets/css/dark_theme.css" rel="stylesheet">
        <link th:href="@{/css/custom.css}" href="../../assets/css/custom.css"
              rel="stylesheet">
        <link th:href="@{/iron/css/categories.css}" rel="stylesheet">
        <link th:href="@{/iron/css/products.css}" rel="stylesheet">
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <link th:href="@{/fileinput/fileinput.css}" rel="stylesheet"/>
        <script th:src="@{/fileinput/fileinput.js}"></script>
        <script th:src="@{/fileinput/zh.js}"></script>
        <script th:src="@{/plugins/jquery/jquery-3.4.1.min.js}"
                src="../../assets/plugins/jquery/jquery-3.4.1.min.js"></script>
        <script th:src="@{/plugins/bootstrap/popper.min.js}"
                src="../../assets/plugins/bootstrap/popper.min.js"></script>
        <script th:src="@{/plugins/bootstrap/js/bootstrap.min.js}"
                src="../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script th:src="@{/plugins/jquery-slimscroll/jquery.slimscroll.min.js}"
                src="../../assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js"></script>
        <script th:src="@{/plugins/jquery-sparkline/jquery.sparkline.min.js}"
                src="../../assets/plugins/jquery-sparkline/jquery.sparkline.min.js"></script>
        <script th:src="@{/plugins/apexcharts/dist/apexcharts.min.js}"
                src="../../assets/plugins/apexcharts/dist/apexcharts.min.js"></script>
        <script th:src="@{/plugins/blockui/jquery.blockUI.js}"
                src="../../assets/plugins/blockui/jquery.blockUI.js"></script>
        <script th:src="@{/plugins/flot/jquery.flot.min.js}"
                src="../../assets/plugins/flot/jquery.flot.min.js"></script>
        <script th:src="@{/plugins/flot/jquery.flot.time.min.js}"
                src="../../assets/plugins/flot/jquery.flot.time.min.js"></script>
        <script th:src="@{/plugins/flot/jquery.flot.symbol.min.js}"
                src="../../assets/plugins/flot/jquery.flot.symbol.min.js"></script>
        <script th:src="@{/plugins/flot/jquery.flot.resize.min.js}"
                src="../../assets/plugins/flot/jquery.flot.resize.min.js"></script>
        <script th:src="@{/plugins/flot/jquery.flot.tooltip.min.js}"
                src="../../assets/plugins/flot/jquery.flot.tooltip.min.js"></script>
        <script th:src="@{/js/connect.min.js}"
                src="../../assets/js/connect.min.js"></script>
        <script th:src="@{/js/pages/dashboard.js}"
                src="../../assets/js/pages/dashboard.js"></script>
        <script src="../../assets/js/pages/mailbox.js"
                th:src="@{/js/pages/mailbox.js}"></script>
    </head>
    <body>

        <div th:replace="back/include::modal" id="modal"></div>
        <div class='loader'>
            <div class='spinner-grow text-primary' role='status'>
                <span class='sr-only'>Loading...</span>
            </div>
        </div>
        <div class="connect-container align-content-stretch d-flex flex-wrap">
            <div th:replace="back/include::left" id="left"></div>
            <div class="page-container">
                <div class="page-content">

                    <div class="main-wrapper">
                        <div class="row">
                            <div class="col-lg-3">
                                <div th:replace="back/include::card-list" id="card-list"></div>
                            </div>
                            <div class="col-lg-9">
                                <div class="card">
                                    <div class="card-body">
                                        <table class="table table-hover center">
                                            <thead>
                                            <th>产品类型</th>
                                            <th>产品内容</th>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td>名称</td>
                                                <td><input placeholder="请输入产品名称" id="productName"
                                                           class="form-control"/></td>
                                                <td>
                                                    <button id="test" class="iron-hidden">test</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>名称(English)</td>
                                                <td><input placeholder="请输入产品名称" id="productNameE"
                                                           class="form-control"/></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>piece</td>
                                                <td><input placeholder="piece" id="productPiece" type="number"
                                                           class="form-control"/></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>封面</td>
                                                <td width="60%"><img alt="" id="ProductCover"/>
                                                </td>
                                                <td><a id="ProductCoverAdd">添加</a></td>
                                            </tr>
                                            <tr>
                                                <td>型号</td>
                                                <td><input placeholder="请输入产品型号" id="productModel"
                                                           class="form-control"/></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>型号(English)</td>
                                                <td><input placeholder="请输入产品型号" id="productModelE"
                                                           class="form-control"/></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>描述</td>
                                                <td colspan="2"><textarea placeholder="请输入产品描述"
                                                                          id="productDescribe"
                                                                          class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td>描述(English)</td>
                                                <td colspan="2"><textarea placeholder="请输入产品描述"
                                                                          id="productDescribeE"
                                                                          class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td>简单描述</td>
                                                <td colspan="2"><textarea placeholder="请输入产品描述"
                                                                          id="productSimple"
                                                                          class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td>简单描述(English)</td>
                                                <td colspan="2"><textarea placeholder="请输入产品描述"
                                                                          id="productSimplee"
                                                                          class="form-control"></textarea></td>
                                            </tr>
                                            <tr>
                                                <td>最低价格</td>
                                                <td><input placeholder="请输入产品价格" id="productPrize" type="number"
                                                           class="form-control"/></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>最高价</td>
                                                <td><input placeholder="请输入美元价格" id="productPrizee" type="number"
                                                           class="form-control"/></td>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>分类</td>
                                                <td><select id="proCat" class="form-control">
                                                    <th:block th:each="c:${categories}">
                                                        <option th:attr="data-id=${c.id}">[[${c.name}]]</option>
                                                    </th:block>
                                                </select></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    产品属性
                                                    <svg id="addProductAttr" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-file-plus-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                        <path fill-rule="evenodd" d="M12 1H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zM8.5 6a.5.5 0 0 0-1 0v1.5H6a.5.5 0 0 0 0 1h1.5V10a.5.5 0 0 0 1 0V8.5H10a.5.5 0 0 0 0-1H8.5V6z"/>
                                                    </svg>
                                                </td>
                                                <td colspan="2" id="productAttrList">
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>照片 (<a id="BoxButton">选择照片</a>)
                                                </td>
                                                <td width="78%" colspan="2">
                                                    <div class="content-img">
                                                        <div id="ImgBox"></div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td width="20%">
                                                    <button class="btn btn-info" id="productUpload">提交</button>
                                                </td>

                                            </tr>
                                            </tbody>
                                        </table>
                                        <input type="file" id="ProductCoverInput" class="iron-hidden" accept="image/*"/>
                                        <input type="file" name="file" id="BoxInput" class="iron-hidden"
                                               accept="image/*"/>

                                        <div th:replace="back/CommonInclude::common"></div>
                                        <div th:replace="back/CommonInclude::url"></div>
                                        <div th:replace="back/include::ProductAttrTemplate"></div>

                                        <script type="text/javascript" th:inline="javascript">

                                            function deleteProductAttr(e){
                                                 $(e).parent(".ProductAttr").remove();
                                            }
                                            $("#addProductAttr").click(function(){
                                                $("#productAttrList").append($("#ProductAttrTemplate").html())
                                            })

                                            let box = Box.instance($("#BoxButton"), $("#BoxInput"), $("#ImgBox"))
                                            box.init()
                                            toClickInput("#ProductCoverAdd", "#ProductCoverInput")
                                            $("#ProductCoverInput").change(function () {
                                                $("#ProductCover").attr("src", getFileTempPath(getInputFile(this)))
                                                $("#ProductCoverAdd").html("修改")
                                            })
                                            $("#productUpload").click(function () {
                                                if (getInputFile("#ProductCoverInput") == null){
                                                   return alert("请设置产品封面")
                                                }
                                                let formData = new FormData();
                                                formData.append("name", getVal("#productName"))
                                                formData.append("piece", getVal("#productPiece"))
                                                formData.append("name_en", getVal("#productNameE"))
                                                formData.append("intro", getVal("#productDescribe"))
                                                formData.append("intro_en", getVal("#productDescribeE"))
                                                formData.append("simple_intro", getVal("#productSimple"))
                                                formData.append("simple_intro_en", getVal("#productSimplee"))
                                                formData.append("prize", getVal("#productPrize"))
                                                formData.append("maxPrize", getVal("#productPrizee"))
                                                formData.append("model", getVal("#productModel"))
                                                formData.append("model_en", getVal("#productModelE"))
                                                formData.append("cid", $('#proCat option:selected').attr("data-id"))
                                                formData.append("coverFile", getInputFile("#ProductCoverInput"))

                                                if (formData_isNull(formData)) {
                                                    return alert("不能为空")
                                                }

                                                //提交Product
                                                let result = postRequest(addProductUrl(), formData)
                                                //提交Product attr
                                                addProductAttr(result.id);
                                                //提交Product Img
                                                let ProductImgFormData = getFormData("pid",result.id)
                                                fromData_appentFile(ProductImgFormData, box.FileList)
                                                postRequest(addProductImgUrl(),ProductImgFormData)
                                                alert("添加成功")
                                                location.reload();
                                            })

                                            function addProductAttr(pid){
                                                $("#productAttrList").find(".ProductAttr").each(function () {
                                                    let formData = new FormData();
                                                    formData.append("name",$(this).find(".attrName").val())
                                                    formData.append("value",$(this).find(".attrValue").val())
                                                    formData.append("nameEn",$(this).find(".attrNameEn").val())
                                                    formData.append("valueEn",$(this).find(".attrValueEn").val())
                                                    formData.append("pid",pid)
                                                    postRequest(addProductAttrUrl(),formData)
                                                })
                                            }

                                        </script>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="page-footer">
                        <div class="row">
                            <div class="col-md-12">
							<span class="footer-text">2020 © <a
                                    href="/iron/front/index">iron</a></span>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
        <div class="mailbox-compose-overlay"></div>
        <div class="mailbox-item-overlay"></div>

        <div th:replace="back/include::showImgModal" id="showImgModal"></div>

    </body>
</html>